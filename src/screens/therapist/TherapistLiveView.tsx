import React from 'react'; import { ScrollView,Text,TextInput,Pressable,StyleSheet,Alert } from 'react-native'; import SessionTimer from '../../components/SessionTimer'; import { ACTIVE_BACKEND } from '../../config/backend'; import { LocalBackend, FirebaseBackend } from '../../backend'; import storage from '@react-native-firebase/storage'; export default function TherapistLiveView(){ const backend=ACTIVE_BACKEND==='firebase'?FirebaseBackend:LocalBackend; const [studentId,setStudentId]=React.useState('S12345'); const [notes,setNotes]=React.useState(''); const [artifacts,setArtifacts]=React.useState<any[]>([]); const snap=async()=>{ const ts=Date.now(); try{ const path=`artifacts/${studentId}/${ts}/notes.txt`; await storage().ref(path).putString(notes||''); const url=await storage().ref(path).getDownloadURL(); await backend.saveArtifact({id:String(ts),ts,studentId,payload:{type:'snapshot',notes,url}}); Alert.alert('Saved','Snapshot saved (with Cloud Storage URL).'); }catch(e:any){ Alert.alert('Upload failed', e?.message||String(e)); } const list=await backend.getArtifactsByStudent(studentId); setArtifacts(list); }; React.useEffect(()=>{ backend.getArtifactsByStudent(studentId).then(setArtifacts); },[studentId]); return (<ScrollView contentContainerStyle={{padding:16}}><Text style={s.h}>Therapist Live View</Text><SessionTimer storageKey={`ther:live:${studentId}`} /><TextInput style={s.in} value={studentId} onChangeText={setStudentId} placeholder='Student ID'/><TextInput style={[s.in,{height:80}]} value={notes} onChangeText={setNotes} placeholder='Live notes' multiline/><Pressable style={s.btn} onPress={snap}><Text style={s.bt}>ðŸ“¸ Snapshot</Text></Pressable><Text style={{marginTop:10,fontWeight:'900'}}>Recent artifacts</Text>{artifacts.map((a,i)=>(<Text key={i}>{new Date(a.ts).toLocaleString()} â€” {JSON.stringify(a.payload)}</Text>))}</ScrollView>);} const s=StyleSheet.create({h:{fontSize:22,fontWeight:'900'},in:{borderWidth:1,borderRadius:10,padding:8,marginTop:8},btn:{borderWidth:1,borderRadius:10,padding:10,marginTop:8,alignSelf:'flex-start'},bt:{fontWeight:'900'}});
