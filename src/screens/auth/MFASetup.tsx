import React from 'react'; import { ScrollView,View,Text,TextInput,Pressable,StyleSheet } from 'react-native'; import { startTotpEnrollment } from '../../auth/mfa'; const theme=require('../../config/tameTheme').TameTheme; export default function MFASetup(){ const [qr,setQr]=React.useState<string|undefined>(); const [secret,setSecret]=React.useState<string|undefined>(); const [otp,setOtp]=React.useState(''); const begin=async()=>{ try{ const { secret, qrCodeUrl, finalize } = await startTotpEnrollment() as any; setSecret(secret); setQr(qrCodeUrl); (globalThis as any).__tameFinalizeTotp=finalize; }catch(e:any){ alert('Failed: '+(e?.message||String(e))); } }; const complete=async()=>{ try{ const f=(globalThis as any).__tameFinalizeTotp; if(!f) throw new Error('Tap Start TOTP first'); await f(otp); alert('TOTP enrolled'); }catch(e:any){ alert('Failed: '+(e?.message||String(e))); } }; return (<ScrollView contentContainerStyle={{padding:16, backgroundColor: theme.colors.surface}}><Text style={[s.h,{color:theme.colors.primary}]}>Multi‑Factor Authentication (TOTP)</Text><Pressable style={[s.btn,{borderColor:theme.colors.primary}]} onPress={begin}><Text style={[s.bt,{color:theme.colors.primary}]}>Start TOTP</Text></Pressable>{qr && (<View style={s.card}><Text selectable>{qr}</Text><Text selectable>Secret: {secret}</Text><TextInput style={s.in} placeholder='Enter 6‑digit code' value={otp} onChangeText={setOtp} keyboardType='number-pad'/><Pressable style={[s.btn,{borderColor:theme.colors.primary}]} onPress={complete}><Text style={[s.bt,{color:theme.colors.primary}]}>Verify & Enroll</Text></Pressable></View>)}</ScrollView>); } const s=StyleSheet.create({h:{fontSize:22,fontWeight:'900'},btn:{borderWidth:2,borderRadius:10,padding:10,marginTop:10,alignSelf:'flex-start'},bt:{fontWeight:'900'},card:{borderWidth:1,borderRadius:12,padding:12,marginTop:10},in:{borderWidth:1,borderRadius:10,padding:10,marginTop:8,borderColor:'#CBD5E1',backgroundColor:'#fff'}});
